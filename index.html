<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shift Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
/* ---------- THEME ---------- */
:root {
  --bg: #f2f2f7;
  --card: #ffffff;
  --text: #000000;
  --header: #e5e5ea;
}

body.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #ffffff;
  --header: #2a2a2a;
}

body {
  margin: 0;
  padding: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* ---------- CONTROLS ---------- */
.controls {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 10px;
}

select, button {
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 15px;
  border: none;
}

button {
  background: #007AFF;
  color: white;
}

/* ---------- MONTH NAV ---------- */
.month-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.month-nav button {
  font-size: 20px;
  padding: 6px 12px;
}

/* ---------- CALENDAR ---------- */
.calendar-wrapper {
  max-height: 75vh;
  overflow: auto;
  background: var(--card);
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.calendar {
  min-width: 600px;
}

.header, .row {
  display: grid;
  grid-template-columns: 110px repeat(5, 1fr);
  text-align: center;
}

.header {
  position: sticky;
  top: 0;
  background: var(--header);
  z-index: 5;
  font-weight: bold;
}

.row div, .header div {
  padding: 10px 0;
  border-bottom: 1px solid #ccc;
}

/* Sticky date column */
.date-cell, .header-date {
  position: sticky;
  left: 0;
  background: var(--card);
  z-index: 4;
  font-weight: bold;
}

/* ---------- DAY LABEL ---------- */
.day {
  font-size: 12px;
  opacity: 0.7;
}

/* ---------- SHIFTS ---------- */
.M { background: #ffe599; }
.A { background: #9fc5e8; }
.N { background: #8e7cc3; color: white; }
.O { background: #d9d9d9; }

/* ---------- TODAY ---------- */
.today {
  outline: 3px solid #007AFF;
  outline-offset: -3px;
}

/* ---------- SELECTED GROUP ---------- */
.selected {
  box-shadow: inset 0 0 0 3px #ff9500;
}

.fade {
  opacity: 0.25;
}
</style>
</head>

<body>

<div class="controls">
  <select id="groupSelect" onchange="saveSettings()">
    <option value="-1">All</option>
    <option value="0">A</option>
    <option value="1">B</option>
    <option value="2">C</option>
    <option value="3">D</option>
    <option value="4">E</option>
  </select>

  <button onclick="toggleLang()">AR / EN</button>
  <button onclick="toggleDark()">ðŸŒ™</button>
</div>

<div class="month-nav">
  <button onclick="changeMonth(-1)">â—€</button>
  <h2 id="monthTitle"></h2>
  <button onclick="changeMonth(1)">â–¶</button>
</div>

<div class="calendar-wrapper">
  <div class="calendar">
    <div class="header">
      <div class="header-date" id="dateLabel">Date</div>
      <div>A</div><div>B</div><div>C</div><div>D</div><div>E</div>
    </div>
    <div id="calendarBody"></div>
  </div>
</div>

<script>
/* ---------- DATA ---------- */
const shiftCodes = ["M","A","N","O","O"];

const shiftNames = {
  en: { M:"Morning", A:"Afternoon", N:"Night", O:"Off" },
  ar: { M:"ØµØ¨Ø­", A:"Ø¹ØµØ±", N:"Ù„ÙŠÙ„", O:"Ø±Ø§Ø­Ø©" }
};

const days = {
  en: ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],
  ar: ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"]
};

// ðŸ”‘ FIXED BASE: 15 JAN â†’ A=M, B=A, C=N, D/E=O
const referenceDate = new Date(2026,0,15);

/* ---------- STATE ---------- */
let currentDate = new Date();
let lang = localStorage.getItem("lang") || "en";
let dark = localStorage.getItem("dark") === "true";

document.getElementById("groupSelect").value =
  localStorage.getItem("group") ?? "-1";

if (dark) document.body.classList.add("dark");

/* ---------- FUNCTIONS ---------- */
function saveSettings() {
  localStorage.setItem("group", document.getElementById("groupSelect").value);
  renderCalendar();
}

function toggleLang() {
  lang = lang === "en" ? "ar" : "en";
  localStorage.setItem("lang", lang);
  renderCalendar();
}

function toggleDark() {
  dark = !dark;
  localStorage.setItem("dark", dark);
  document.body.classList.toggle("dark");
}

function changeMonth(step) {
  currentDate.setMonth(currentDate.getMonth() + step);
  renderCalendar();
}

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const selectedGroup = parseInt(document.getElementById("groupSelect").value);

  document.getElementById("monthTitle").innerText =
    currentDate.toLocaleString(lang, { month:"long", year:"numeric" });

  document.getElementById("dateLabel").innerText =
    lang === "ar" ? "Ø§Ù„ØªØ§Ø±ÙŠØ®" : "Date";

  const body = document.getElementById("calendarBody");
  body.innerHTML = "";

  const today = new Date();
  today.setHours(0,0,0,0);

  const daysInMonth = new Date(year, month+1, 0).getDate();

  for (let d=1; d<=daysInMonth; d++) {
    const row = document.createElement("div");
    row.className = "row";

    const thisDay = new Date(year,month,d);
    thisDay.setHours(0,0,0,0);

    const dateCell = document.createElement("div");
    dateCell.className = "date-cell";
    dateCell.innerHTML = `${d}<div class="day">${days[lang][thisDay.getDay()]}</div>`;

    if (thisDay.getTime() === today.getTime())
      dateCell.classList.add("today");

    row.appendChild(dateCell);

    const diff = Math.floor((thisDay - referenceDate) / 86400000);

    for (let g=0; g<5; g++) {
      const idx = (diff + g + 5) % 5;
      const code = shiftCodes[idx];

      const cell = document.createElement("div");
      cell.className = code;
      cell.innerText = shiftNames[lang][code];

      if (thisDay.getTime() === today.getTime())
        cell.classList.add("today");

      if (selectedGroup === g) cell.classList.add("selected");
      else if (selectedGroup !== -1) cell.classList.add("fade");

      row.appendChild(cell);
    }

    body.appendChild(row);
  }
}

renderCalendar();
</script>

</body>
</html>
